\IEEEPARstart{T}{he} market for Electrical Vehicles (EV) has grown significantly over the past decade~\cite{state-ev-australia}.
The replacement of a fossil fuel-based engine with an electric drivetrain eliminates exhaust emissions with the potential to reduce human impact on climate change significantly.
For EVs to grow market share and reduce costs, battery cost and longevity must be improved.
Extensive battery cycling leads to battery degradation over time (aging).
The development of smarter and more accurate battery management strategies may be capable of prolonging service duty.
This would rely upon a system's ability to estimate a battery's state at any point in time.
An accurate charge calculation avoids overcharging or over-discharging, leading to improved battery service utilisation, better health estimation, longer life span, more reliable range prediction and further benefits~\cite{calif_proper_2008}.

%
%
The development of effective methods for State-of-Charge (SoC) estimation remains a topic of crucial research focus.
Various techniques to estimate the SoC have been developed to enhance battery usage.
The ability to determine the state of a battery or a battery system is a required function for an advanced Battery Management System (BMS).
Those techniques can be classified into three primary categories~\cite{ali_towards_2019,ng_enhanced_2009,robust_SoC,6953745}: direct measurement, model-based methods, and computer intelligence or Machine Learning (ML).
Direct measurements methods take readings from batteries relying on sensors, such as open circuit Voltage, internal resistance, or current readings over set periods (i.e. Coulomb Counting)~\cite{ng_enhanced_2009,robust_SoC}.
Model-based methods recreate battery behaviour and use sensor inputs to calculate results from a pre-defined model~\cite{6953745}.
Computer intelligence techniques enhance such models with additional data.
Those data-driven calculations aim to improve model estimation by fitting to an actual behaviour observation.
Examples include Fuzzy Logic~\cite{malkhandi_fuzzy_2006}, Support Vector Machine~\cite{hansen_support_2005, anton_battery_2013}, or Neural Networks (NN)~\cite{song_lithium-ion_2018,Chemali2017,mamo_long_2020,jiao_gru-rnn_2020,xiao_accurate_2019,javid_adaptive_2020,zhang_deep_2020}.

%
%
While some model-based methods, such as the equivalent circuit model, are simple to implement within a BMS, many cannot correctly capture batteries' complex multi-dependant behaviour~\cite{6953745}.
%Others are limited to offline simulation due to high complexity and computation requirements, therefore not suited to an onboard BMS.
Direct measurement estimation is limited to sensor accuracy and affected by losses created by Coulombic efficiencies~\cite{Smith_2010} where some portion of charge gets transferred to heat or gets affected by battery ageing that is not captured.
%Additionally, the measured voltage depends on whether the battery is in use or has been on rest for a given time.
%An accurate SoC estimation model has to implement a way to accommodate battery losses and sensor readings.
%If model-based methods treat as constant values, then in real scenarios, they can be significantly limited to sensor inaccuracy, environmental and internal battery temperature, or aging.
%In contrast, Neural Network methods can accommodate losses as they can capture complex phenomenological behaviours~\cite{bengio_learning_1994}.
%
%Smart BMSs, which incorporate some method of ML, use only sensory data~\cite{zhang_deep_2020} and do not require a batteries physical property~\cite{zhang_deep_2020}.
In contrast, Machine Learning are known to be able to establish relationships in complicated and multi-dimensional non-linear systems~\cite{hansen_support_2005,anton_battery_2013,he_state_2014}.
This characteristic shows great potential to account for battery losses due to Coulumbic efficiency.
Some researchers used the support vector machine-based methods to estimate SoC using voltage, current, and temperature inputs~\cite{hansen_support_2005,anton_battery_2013}.
Data were obtained from a driving schedule profile on a battery cycler, and the end error estimation was achieved as less than 6\%~\cite{he_state_2014}.
%The solution to lowering that percentage may lie within the more complicated models, like Neural Networks.
Many attempts to implement different Neural Networks exist, but the most promising net for charge estimation were Recurrent Neural Networks (RNN)~\cite{song_lithium-ion_2018,Chemali2017,mamo_long_2020,jiao_gru-rnn_2020,xiao_accurate_2019,javid_adaptive_2020,zhang_deep_2020}.
Their effectiveness in time-series dependant problems was shown using internal neurons to process data sequences with varying lengths by Chemali et al.~\cite{Chemali2017}.
% The models' cells act as memory units, building relationships and giving outputs based on multiple inputs over time.
% Typical examples are data forecasting, handwriting, speech and image recognition, machine translation or music composition~\cite{devdarshan_applications_2019}. 

% 
%
Over the past years, the RNN approach has found multiple applications for SoC estimation.
The most recent attempt to determine the Li-Ion battery's remaining useful life was with implementation of the Gradient Recurrent Unit models~\cite{song_lithium-ion_2018,javid_adaptive_2020,xiao_accurate_2019,jiao_gru-rnn_2020}.
The earliest approach utilised a battery charge's regression nature only using stateless models~\cite{song_lithium-ion_2018,jiao_gru-rnn_2020,xiao_accurate_2019} when input impact is not preserved for further predictions.
Later, some approaches introduced additional parameters to support the NN learning process~\cite{mamo_long_2020,jiao_gru-rnn_2020,javid_adaptive_2020}.
Besides good convergences, the model's use was in determining critical events, like the time before complete charge depletion or overcharge.
However, it did not receive wide application due to its initial state requirement as input features.
The most popular way lies in determining the charge's value using a fixed size history of voltage, current, and temperature in stateless Long Short-Term Memory (LSTM) models~\cite{Chemali2017,mamo_long_2020,javid_adaptive_2020,zhang_deep_2020}.
The method's advantage is independent of the charge or discharge cycles at different times, as long as the history samples are in order.
However, estimation determines values based on fixed history samples and does not preserve for the next prediction, making practical estimation of single or several charge values, but not determining critical events ahead.
That can be achieved with stateful models, which continuously preserve the prediction's impact and can be propagated further until they reach the end state without resets~\cite{zhu_statefulnes_tfdocs_2020}.

%
%
One of the first attempts to train an RNN model to predict the state of charge is to train in several cycles of a single battery utilisation dataset at different temperatures~\cite{song_lithium-ion_2018, xiao_accurate_2019,javid_adaptive_2020, jiao_gru-rnn_2020}.
Then as others attempted to generalise battery behaviour to multiple usage scenarios, which as comparison lead to higher Root Mean Squared Error.~\cite{mamo_long_2020}.
For instance, by comparing similar procedures of testing from Song et al.~\cite{song_lithium-ion_2018} and Mamo et al.~\cite{mamo_long_2020} who conducted their research methods but used different validation mechanisms, it can be seen how accuracy error doubles if testing performs at a different temperature or untrained driving profile.
By selecting same drive cycles at closely similar temperature, Song et al.~\cite{song_lithium-ion_2018} accuracy acchieved rougly 0.735\% error, then as Mamo et al.~\cite{mamo_long_2020} reported 1.2533\% at best.
This can be explained that most researchers used a single driving profile, but with an entire available temperature range for training and then a portion of handpicked temperatures for validation and accuracy report.
This behaviour is less realistic to the actual scenario since during a single acceleration event, the battery goes through ambient temperature to the maximum allowed within several seconds, and its' usage depends on the condition of a road and drivers experience.
Mamo et al.~\cite{mamo_long_2020} attempted to generalise this behaviour by using the addition layer construction technique to make a model be appliable to any driving condition and more realistic scenario.
There has been little research to validate the performance of different Machine Learning techniques to extrapolate ideal laboratory batter cycling conditions of early collected data to an electric vehicle behaviour.
%% (Include to one of the sections)
% After identifying the most optimal input preferences without significant effect on the performance, one of the further developments apply changes to the structure of GRU or LSTM by adding additional layers (Attention or Extra Dense layers)~\cite{mamo_long_2020, jiao_gru-rnn_2020}.
% Another way is to change the optimisation process to achieve similar accuracy faster (i. e., adding a Momentum algorithm to the Stochastic Gradient Optimisations process or replacing gradient calculations with statistical)~\cite{xiao_accurate_2019, javid_adaptive_2020}.
% Those methods modify standard ways introduced earlier in model training by applying additional operations.
% As a result, they met to achieve better accuracy faster using similar training approaches. 
However, after identifying the most optimal input preferences, some researchers applied changes to the structure of models by adding additional layers (Attention or Extra Dense layers~\cite{mamo_long_2020, jiao_gru-rnn_2020}) or modified optimisers (i. e., adding a Momentum algorithm to the Stochastic Gradient Optimisations process~\cite{xiao_accurate_2019}) to further enhance the speed of the training process to achieve the lowest error.
\mbox{Table~\ref{tab:review}} summarises the most common methods applied to SoC estimation, highlighting the model cell type, structure to define input sample type, optimiser selection, and additional features introduced by authors to improve predictions.
\textcolor{red}{\textbf{Matt: I moved most of the details about the table to caption. However, since this paragraph and next were swapped I had to do my best to avoid driving profile mentioning where possible. Perhaps we should consider swapping them back or some sentences.}}
\begin{table*}[h]
    \renewcommand{\arraystretch}{1.3}
    \caption{Reviewed papers implementation summary.
    The model type highlights a primary path in structuring a Neural Network.
    The statefulness defines the input method, where stateless uses a fixed size of input samples per each feature and statefully apply each time sample at a time for all features one by one.
    %Optimiser selection sets the algorithm for the learning process from one of the following methods: Adaptive moment estimation (Adam), Nesterov adaptive moment estimation  (Nadam), Stochastic gradient descent (SGD), AdaMax (AM) and Differential Evolution (DE).
    Optimiser defined from: Adaptive moment estimation (Adam), Nesterov adaptive moment estimation  (Nadam), Stochastic gradient descent (SGD), AdaMax (AM) and Differential Evolution (DE).
    }
    \centering
    \label{tab:review}
\resizebox{\textwidth}{!}{
\begin{tabular}{l|c|c|c|c|c|c|c|c|c|l}
    \hline\hline \\[-4mm]
    \multicolumn{1}{ c }{} & 
    \multicolumn{2}{|c|}{Model} & 
    \multicolumn{2}{ c|}{State-} & 
    \multicolumn{5}{ c|}{Optimiser} &
    \multirow{2}{ 4em }{Extension} \\
    \cline{1-4} \cline{5-10}
    Reference source & GRU  & LSTM & -less & -ful & Adam & Nadam & SGD & AdaMax & DE\footnote{Differential Evolution} & \\
    \hline
    Song~\cite{song_lithium-ion_2018}
        & \chk &      &      & \chk & \chk &      &      &      &      & 4 Layers  \\
    Chemali~\cite{Chemali2017}
        &      & \chk & \chk &      & \chk &      &      &      &      &           \\
    Mamo~\cite{mamo_long_2020}
        &      & \chk & \chk &      &      &      &      &      & \chk & Attention \\
    Jiao~\cite{jiao_gru-rnn_2020}
        & \chk &      &      & \chk &      &      & \chk &      &      & Momentum  \\
    Xiao~\cite{xiao_accurate_2019}
        & \chk &      &      & \chk &      & \chk &      & \chk &      & Ensemble  \\
    Javid~\cite{javid_adaptive_2020}
        & \chk &      & \chk &      & \chk &      &      &      &      & Robust    \\
    Zhang~\cite{zhang_deep_2020}
        &      & \chk & \chk &      &      & \chk &      &      &      & Online    \\
    \hline\hline
\end{tabular}
}
\end{table*}

% Althpugh, experement which involved extrapolation ideal laboratory conditions with accurate sensory to a real world conditions, woth different environmental charecteristic or sensorary interferance - is not currently available.
%
In most published testing of ML methods applied to SoC, experiments on battery cycling data were conducted on different cell types.
Most used table data of real-time sensory results from battery cyclers to validate efficiencies generated using different current schedulers (driving profiles)~\cite{Chemali2017,song_lithium-ion_2018,mamo_long_2020,jiao_gru-rnn_2020,xiao_accurate_2019}.
%An equally time-based sample of current consumption acts as an input to the battery cycler, intended to recreate a stress test on a battery or human driving behaviour.
There are three the most commonly used in the research of this area: Dynamic Stress Test (DST) for a variable power discharge mode, aggressive Highway Drive Schedule (US06) and Federal-Urban Driving Scheduler (FUDS) for nominal driving scenarios.
Unlike some general simple static discharge processes, which commonly appear in other battery-based tools, driving profiles include some amount of regenerative driving to simulate the actual application of the battery for an electric vehicle.
%
% Mamo et al.~\cite{mamo_long_2020} conducted experiments by validating the RNN model performance by training one driving profile and testing against the other two.
% The results showed doubled higher Root Mean Squared Error, as opposed to training and validation over single driving profiles as per experiments by Xiao et al.~\cite{xiao_accurate_2019}.
%
The process of identifying the best-suited method for a specific condition, like driving an EV, is one of the crucial steps for machine learning engineering.
It requires carefully defined methodology, which characterises researched conditions as close as possible, and experimental results from multiple models with appliable techniques and the lowest errors.
By comparing implementation and results from different sources and testing accuracy and performance against multiple driving conditions at various temperatures from ambient to maximum possible, it is possible to select the best machine learning technique, which can be integrated directly into an Electric vehicle and safely used either on tight city roads or long high-speed highways.
%There have not been many similar experiments against other SoC estimation methods since such validation procedures are necessary for the computer intelligence method compared to battery modelling.
% In addition, all investigations did poor research in extrapolating ideal laboratory conditions with battery cycler, stable temperatures and no sensor discrepancies to an actual driving situation on the road, mainly due to lack of car data.
%
% Usage of a single profile's battery cycling data may not validate ML methods' efficiency in driving an electric vehicle.
% The inability to determine the charge's current state during EV driving makes the online learning process inapplicable.
% Even with other SoC estimation technique usage, the computational complexity of training any NN is complicated to fit on a low power device.
% An offline trained model had the advantage of insignificant resource consumption during the prediction stage, making it a prefered way for an EV.
% All further model testing will be applied through varying battery cycling profiles to capture the influence of data type to model efficiency.
%
% (No point)
% The drawback lies within the validation procedures of produced models.
% Ideally, this process must be performed with similar data but under different conditions or at different times.
% However, once the produced model is taken through different unseen scenarios, the accuracy lowers drastically compared to early reported results since it starts to experience something completely unexpected.
% The lack of training samples or means to produce at different conditions affected the final judgment results of many publications. 
% Even though the estimation produces accurate output with tabled data, placed under actual driving conditions - the model will have difficulties matching training performance. 


%
%
% Mamo et al. conducted experiments
%
% ------------------------------------------------------------------------ \\
% PAPER CONTRIBUTION may be worth adding as a clear statement \\
% ------------------------------------------------------------------------ \\
% Asses handpicked articles from different categories of SoC estimation, asses efficiency and complexity to utilise in EV.
% This paper's contribution lies in researching recent approaches used to estimate Charge's State from battery sensor readings.
% Comparing and implementing the most promising algorithms intended to determine the direction to build upon in the future. \\ \\
% This paper will test recent developments in the most common SoC prediction to determine the most promising direction/approach towards implementing an improved and light model applied to an electric vehicle.
% It determined to find the ML model creation's weakness and implement a new one for an EV. \\
% ------------------------------------------------------------------------ \\
%
%
% This paper investigates, implements and compares extended memory-based models of RNN to predict the State of Charge and additional built-on over time techniques to select the most effective and least resource requiring onboard-based computations appliable within Electrical Vehicles.
This paper investigates, implements and compares extended memory-based models of RNN to predict the State of Charge and additional built-on over time techniques to select the most suitable for practical application to be used in EV using combinations of different profiles.
Each subset will contain implementation from various articles changing either structure of the models or learning approaches.
It should help develop a methodology that will be further used to extrapolate offline trained methods from the lab condition to the road drive tests.
% The recent advancement and commonly used subsets are Gradient Recurrent Unit and Long Shot-Term Memory unit cells.
% Recurrent Neural Network has been confirmed to be suitable for the battery-related system by authors discussed further, such as Chemali~\cite{LSTM_Hochreiter1997}.
% However, there is no valid proof of if GRU or LSTM is helpful for battery SoC estimation.
% The best way to separate them and explore differences and efficiencies is to use them as Stateful and Stateless models.
The A123 Lithium-Ion battery data with three typical driving profiles, obtained from the University of Maryland 2012~\cite{noauthor_calce_2017} cycling experiment will act as training and testing samples.
Each method will be validated through those samples (either DST, US06 or FUDS driving profiles) and tested against robustness and accuracy of estimation of State of Charge of batteries in the other two unseen schedulers.
%
The remaining sections are organised as follows: all methodology with details regarding training procedure outlined in Section~\ref{sec:Meth}, with processing data in Subsection~\ref{subsec:b_data} and testing hardware in Subsection~\ref{subsec:soft}.
Every detail on algorithms and optimisers are written in Section~\ref{sec:Body}, where Subsection~\ref{subsec:structure} separates all details for each GRU and LSTM method, and Subsection~\ref{subsec:optimisers} breaks down every applied optimising algorithm.
Section~\ref{sec:conclussion} gives the results of implementation, performance characteristics and concludes the critical analysis.
